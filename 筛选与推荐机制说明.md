# A股推荐算法系统 - 筛选与推荐机制说明

## 系统概述

本系统是一个基于多因子模型的A股推荐算法系统，通过数据获取、特征提取、多因子评分和风险控制等模块，实现股票的智能筛选和推荐。系统主要包含两个核心机制：**股票筛选机制**和**推荐评分机制**。

## 1. 股票筛选机制

### 1.1 基础股票池构建

系统首先通过 `DataFetcher` 模块获取完整的A股股票列表，然后通过多层筛选条件构建候选股票池。

#### 筛选条件：

1. **基本条件筛选**
   - 股票代码和名称不能为空
   - 排除ST股票（包括*ST股票）
   - 排除科创板股票（688开头）
   - 排除创业板股票（300开头）

2. **价格区间筛选**
   - 最低价格：3.0元
   - 最高价格：200.0元

3. **新股筛选**
   - 排除上市不足30天的新股

4. **数量限制**
   - 最大分析股票数量：500只

### 1.2 实时数据筛选

在获取实时行情数据时，系统会进一步筛选：
- 确保股票有有效的实时价格数据
- 过滤掉停牌或异常交易的股票
- 验证成交量和成交额数据的有效性

## 2. 推荐评分机制

### 2.1 多因子特征提取

系统通过 `FeatureExtractor` 模块提取多维度特征，主要包括：

#### 2.1.1 动量因子
- **5日动量** (`momentum_5d`)：近5日价格变化率
- **10日动量** (`momentum_10d`)：近10日价格变化率  
- **20日动量** (`momentum_20d`)：近20日价格变化率
- **RSI指标** (`rsi`)：相对强弱指数，衡量超买超卖状态

#### 2.1.2 成交量因子
- **成交量比率** (`volume_ratio`)：当前成交量与近5日平均成交量的比值
- **成交量突增** (`volume_spike`)：成交量是否突然放大（>2倍）
- **换手率** (`turnover_rate`)：股票流动性指标

#### 2.1.3 资金流向因子
- **主力资金净流入评分** (`main_inflow_score`)：主力资金流向强度
- **大单资金净流入评分** (`large_inflow_score`)：大额资金流向
- **综合资金强度** (`capital_strength`)：整体资金面评估

#### 2.1.4 技术指标因子
- **MACD指标** (`macd`)：趋势跟踪指标
- **布林带位置** (`bollinger_position`)：价格在布林带中的相对位置

#### 2.1.5 情绪因子
- **新闻情绪评分** (`news_sentiment_score`)：基于新闻的市场情绪
- **市场情绪评分** (`market_sentiment_score`)：整体市场情绪
- **综合情绪评分** (`overall_sentiment`)：综合情绪指标

#### 2.1.6 风险因子
- **20日波动率** (`volatility_20d`)：价格波动风险（负权重）
- **价格稳定性** (`price_stability`)：价格稳定程度

### 2.2 因子权重配置

系统采用可配置的因子权重体系，权重分配如下：

```yaml
# 动量因子权重 (总权重: 0.35)
momentum_5d: 0.10
momentum_10d: 0.10
momentum_20d: 0.10
rsi: 0.05

# 成交量因子权重 (总权重: 0.20)
volume_ratio: 0.08
volume_spike: 0.07
turnover_rate: 0.05

# 资金流向因子权重 (总权重: 0.20)
main_inflow_score: 0.10
large_inflow_score: 0.05
capital_strength: 0.05

# 技术指标权重 (总权重: 0.08)
macd: 0.05
bollinger_position: 0.03

# 情绪因子权重 (总权重: 0.17)
news_sentiment_score: 0.08
market_sentiment_score: 0.04
overall_sentiment: 0.05

# 风险因子权重 (总权重: -0.02)
volatility_20d: -0.05  # 负权重，降低高波动股票评分
price_stability: 0.03
```

### 2.3 评分计算流程

#### 2.3.1 特征标准化
1. **数据清洗**：过滤无效数值（NaN、Inf等）
2. **Z-Score标准化**：将各因子标准化到相同量级
3. **异常值处理**：限制极端值的影响

#### 2.3.2 加权评分
1. **线性加权**：各因子乘以对应权重
2. **综合得分**：所有因子得分的加权求和
3. **得分归一化**：将最终得分映射到0-100区间

#### 2.3.3 排序与筛选
1. **按得分排序**：从高到低排列所有股票
2. **Top-K选择**：选择得分最高的前20只股票
3. **多样化检查**：确保推荐股票的行业分散性

### 2.4 推荐结果格式化

最终推荐结果包含以下信息：
- **股票基本信息**：代码、名称、当前价格
- **评分信息**：总得分、各因子得分
- **推荐理由**：基于主要得分因子生成的推荐说明
- **风险提示**：基于风险因子的风险评估

## 3. 卖出决策机制

### 3.1 卖出条件

系统通过 `SellDecision` 模块对前日推荐股票进行卖出分析：

#### 3.1.1 基本卖出条件
- **止盈条件**：收益率 ≥ 3%
- **止损条件**：收益率 ≤ -3%
- **持有期限**：最大持有5个交易日

#### 3.1.2 技术面卖出条件
- **成交量异常**：成交量急剧萎缩
- **技术指标恶化**：MACD、RSI等指标转坏
- **资金流出**：主力资金大幅流出

### 3.2 卖出决策流程

1. **加载前日推荐**：读取前一交易日的推荐结果
2. **获取当前价格**：获取实时股价数据
3. **计算收益率**：对比买入价格和当前价格
4. **执行卖出规则**：根据预设规则判断是否卖出
5. **生成卖出建议**：输出具体的操作建议

## 4. 系统运行机制

### 4.1 定时执行

- **买入分析**：每个交易日14:45执行
- **卖出分析**：每个交易日9:45执行

### 4.2 结果输出

- **JSON格式**：结构化数据存储
- **日志记录**：详细的执行日志
- **控制台输出**：实时分析摘要

### 4.3 配置管理

- **因子权重**：通过 `factor_config.yaml` 配置
- **系统参数**：通过代码配置项调整
- **动态调整**：支持运行时参数修改

## 5. 风险控制

### 5.1 数据风险控制
- **多重验证**：多层数据有效性检查
- **异常处理**：完善的异常捕获和处理
- **重试机制**：网络请求失败自动重试

### 5.2 投资风险控制
- **分散投资**：推荐多只股票分散风险
- **止盈止损**：明确的盈亏控制规则
- **持有期限**：限制最大持有时间

### 5.3 系统风险控制
- **日志监控**：完整的操作日志记录
- **错误恢复**：系统异常时的恢复机制
- **数据备份**：推荐结果的持久化存储

## 6. 系统特点

### 6.1 优势
- **多因子模型**：综合考虑多个维度的市场信息
- **动态权重**：可根据市场情况调整因子权重
- **自动化运行**：减少人工干预，提高效率
- **风险可控**：完善的风险控制机制

### 6.2 适用场景
- **量化投资**：适合量化投资策略的实施
- **辅助决策**：为投资决策提供数据支持
- **风险管理**：帮助控制投资组合风险

---

**注意**：本系统仅供参考，投资有风险，决策需谨慎。建议结合其他分析方法和个人风险承受能力进行投资决策。